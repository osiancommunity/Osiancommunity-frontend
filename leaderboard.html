<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OSIAN â€” Leaderboard</title>

<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<style>
/* ===== THEME VARIABLES (SYNC WITH DASHBOARD) ===== */
:root{
  --bg:#f7fbff;
  --card:#ffffff;
  --primary:#4c8dff;
  --accent:#6a5cd8;
  --muted:#6b7380;
  --text:#0f172a;
  --shadow:0 12px 32px rgba(20,60,120,.08);
  --radius:14px;
  font-family:Poppins,system-ui;
}

[data-theme="dark"]{
  --bg:#0b1220;
  --card:#121a2f;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --shadow:0 15px 40px rgba(0,0,0,.6);
}

body{margin:0;background:var(--bg);color:var(--text)}
.app{display:flex;min-height:100vh}

/* ===== SIDEBAR ===== */
.sidebar{
  width:260px;
  background:var(--card);
  padding:20px;
  box-shadow:var(--shadow);
}
.logo{
  font-size:26px;
  font-weight:800;
  color:var(--primary);
  margin-bottom:26px;
}
.nav a{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  border-radius:12px;
  text-decoration:none;
  color:var(--muted);
  font-weight:600;
  margin-bottom:6px;
}
.nav a.active,.nav a:hover{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
}

/* ===== MAIN ===== */
.main{flex:1;padding:26px}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:22px;
}
.header h1{margin:0;font-size:32px}
.header p{margin-top:6px;color:var(--muted)}

/* ===== PROFILE MENU ===== */
.profile{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  position:relative;
}
.profile img{
  width:42px;height:42px;border-radius:50%;object-fit:cover;
}
.dropdown{
  position:absolute;
  top:54px;
  right:0;
  background:var(--card);
  border-radius:12px;
  box-shadow:var(--shadow);
  display:none;
  min-width:180px;
  z-index:10;
}
.dropdown button{
  width:100%;
  padding:10px 12px;
  border:none;
  background:none;
  text-align:left;
  cursor:pointer;
  display:flex;
  gap:10px;
}
.dropdown button:hover{background:var(--bg)}

/* ===== CONTROLS ===== */
.controls{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:18px;
}
.controls input,.controls select{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #e6efff;
}

/* ===== TOP 3 ===== */
.top3{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:18px;
  margin-bottom:24px;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
  text-align:center;
  position:relative;
}
.medal{
  position:absolute;
  top:-14px;
  right:-14px;
  width:44px;height:44px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:#fff;
}
.gold{background:#fbbf24}
.silver{background:#94a3b8}
.bronze{background:#f97316}

.avatar{
  width:90px;height:90px;border-radius:50%;object-fit:cover;
  margin:0 auto 10px;
}
.name{font-weight:700}
.score{font-size:26px;font-weight:800;color:var(--primary)}
.badge{
  display:inline-block;
  margin-top:8px;
  padding:6px 12px;
  border-radius:999px;
  background:#eef4ff;
  color:var(--primary);
  font-size:13px;
  font-weight:700;
}

/* ===== LIST ===== */
.list{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:14px;
}
.row{
  background:var(--card);
  padding:14px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  gap:12px;
  align-items:center;
}
.rank{
  width:42px;height:42px;border-radius:12px;
  background:#eef4ff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
}
.row img{width:46px;height:46px;border-radius:50%}

/* ===== MOBILE ===== */
.bottom-nav{display:none}
@media(max-width:980px){
  .sidebar{display:none}
  .main{padding-bottom:90px}
  .top3{grid-template-columns:1fr}

  .bottom-nav{
    display:flex;
    position:fixed;
    bottom:0;left:0;width:100%;
    background:var(--card);
    box-shadow:0 -10px 25px rgba(0,0,0,.2);
    border-radius:18px 18px 0 0;
    z-index:9999;
  }
  .bottom-nav a{
    flex:1;
    text-align:center;
    padding:10px 0;
    text-decoration:none;
    color:var(--muted);
    font-size:12px;
    font-weight:600;
  }
  .bottom-nav a i{
    display:block;
    font-size:22px;
    margin-bottom:4px;
  }
  .bottom-nav a.active{color:var(--primary)}
}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">OSIAN</div>
  <nav class="nav">
    <a href="dashboard-user.html"><i class="bx bxs-dashboard"></i>Dashboard</a>
    <a href="quiz-progress.html"><i class="bx bx-file"></i>Quizzes</a>
    <a class="active"><i class="bx bxs-trophy"></i>Leaderboard</a>
    <a href="notifications.html"><i class="bx bx-bell"></i>Notifications</a>
    <a href="profile.html"><i class="bx bxs-user"></i>Profile</a>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">
<div class="header">
  <div>
    <h1>Top Users</h1>
    <p>Live ranking across all quizzes</p>
  </div>

  <div class="profile" id="profileBtn">
    <img id="avatar">
    <i class="bx bx-chevron-down"></i>
    <div class="dropdown" id="dropdown">
      <button onclick="location.href='profile.html'">
        <i class="bx bxs-user"></i> My Profile
      </button>
      <button onclick="logout()" style="color:#ef4444">
        <i class="bx bx-log-out"></i> Logout
      </button>
    </div>
  </div>
</div>

<div class="controls">
  <input placeholder="Search users">
  <select><option>Global</option></select>
  <select><option>All time</option></select>
</div>

<div class="top3" id="top3"></div>
<div class="list" id="list"></div>
</main>
</div>

<!-- MOBILE BOTTOM NAV -->
<nav class="bottom-nav">
  <a href="dashboard-user.html"><i class="bx bxs-dashboard"></i><span>Home</span></a>
  <a href="quiz-progress.html"><i class="bx bx-file"></i><span>Quizzes</span></a>
  <a class="active"><i class="bx bxs-trophy"></i><span>Rank</span></a>
  <a href="notifications.html"><i class="bx bx-bell"></i><span>Alerts</span></a>
  <a href="profile.html"><i class="bx bxs-user"></i><span>Profile</span></a>
</nav>

<script>
/* ===== THEME SYNC ===== */
document.documentElement.setAttribute(
  "data-theme",
  localStorage.getItem("theme") || "light"
);

/* ===== USER ===== */
const user = JSON.parse(localStorage.getItem("user")) || {
  name:"Student",
  avatar:"https://i.pravatar.cc/150?img=3"
};
document.getElementById("avatar").src = user.avatar || "";

/* ===== DROPDOWN ===== */
profileBtn.onclick = e=>{
  e.stopPropagation();
  dropdown.style.display = dropdown.style.display==="block"?"none":"block";
};
document.onclick = ()=>dropdown.style.display="none";

function logout(){
  localStorage.clear();
  location.href="index.html";
}

/* ===== SAFE apiFetch ===== */
const backendUrl =
  location.hostname.endsWith("vercel.app")
    ? "https://osiancommunity-backend.vercel.app/api"
    : (location.hostname==="localhost"||location.hostname==="127.0.0.1")
      ? "http://localhost:5000/api"
      : "https://osiancommunity-backend.vercel.app/api";

async function apiFetch(path){
  const res = await fetch(backendUrl + path);
  if(!res.ok) throw new Error("API Error");
  return res.json();
}

/* ===== LOAD LEADERBOARD ===== */
async function load(){
  let data=[];
  try{
    const res = await apiFetch("/leaderboard");
    if (Array.isArray(res.leaderboard)) data = res.leaderboard;
  }catch{}

  if(!data.length){
    data=[
      {name:"Kudoz",score:92},
      {name:"Aman",score:88},
      {name:"Riya",score:85},
      {name:"Neha",score:80},
      {name:"Arjun",score:78},
    ];
  }

  top3.innerHTML=data.slice(0,3).map((u,i)=>`
    <div class="card">
      <div class="medal ${["gold","silver","bronze"][i]}">${i+1}</div>
      <img class="avatar" src="${u.avatar||user.avatar}">
      <div class="name">${u.name}</div>
      <div class="score">${u.score}%</div>
      <div class="badge">${["Gold","Silver","Bronze"][i]}</div>
    </div>
  `).join("");

  list.innerHTML=data.slice(3).map((u,i)=>`
    <div class="row">
      <div class="rank">${i+4}</div>
      <img src="${u.avatar||user.avatar}">
      <div>
        <strong>${u.name}</strong>
        <div class="badge">Top 10</div>
      </div>
    </div>
  `).join("");
}
load();
</script>
</body>
</html>
