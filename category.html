<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OSIAN — Category</title>

<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
<script src="shared-init.js"></script>

<style>
:root{
  --bg:#f4faff;
  --card:#fff;
  --primary:#4c8dff;
  --accent:#6a5cd8;
  --muted:#6b7380;
  --shadow:0 12px 32px rgba(20,60,120,.06);
  --radius:14px;
  font-family:Poppins,system-ui;
  color:#0f172a;
}
body{margin:0;background:radial-gradient(900px 400px at 0% 0%,#f7fbff,#eaf4ff)}
.container{max-width:1200px;margin:auto;padding:20px;padding-bottom:120px}

.header{display:flex;justify-content:space-between;align-items:center}
.header h1{margin:0;font-size:28px}
.muted{color:var(--muted)}

.hero{
  background:linear-gradient(180deg,#fff,#f7faff);
  border-radius:14px;
  padding:16px;
  margin:14px 0;
  box-shadow:var(--shadow);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.layout{display:grid;grid-template-columns:1fr 360px;gap:18px}
@media(max-width:900px){.layout{grid-template-columns:1fr}}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  box-shadow:var(--shadow);
}

.section-title{font-size:18px;margin-bottom:12px}

/* TOPICS */
.topics-grid{
  display:grid;
  gap:14px;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr))
}
.topic-card{
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  border:2px solid transparent;
  transition:.2s;
}
.topic-card.selected{
  border-color:#4c8dff;
  box-shadow:0 12px 28px rgba(76,141,255,.25);
}
.topic-media{height:140px;background:#eef4ff}
.topic-media img{width:100%;height:100%;object-fit:cover}
.topic-title{font-weight:700;padding:10px}
.topic-desc{padding:0 10px 12px;font-size:13px;color:var(--muted)}

/* LEVELS */
.level-card{
  padding:12px;
  border-radius:10px;
  border:2px solid #eef4ff;
  cursor:pointer;
  margin-bottom:10px;
  opacity:.5;
  pointer-events:none;
  transition:.2s;
}
.level-card.enabled{
  opacity:1;
  pointer-events:auto;
}
.level-card.selected{
  border-color:#6a5cd8;
  background:#f3f0ff;
}

/* QUIZZES */
.quiz-card{
  display:flex;
  gap:12px;
  padding:12px;
  border-radius:10px;
  border:1px solid #eef4ff;
}
.quiz-thumb{width:120px;height:80px;border-radius:8px;overflow:hidden;background:#eef4ff}
.quiz-thumb img{width:100%;height:100%;object-fit:cover}
.quiz-actions{margin-left:auto;display:flex;flex-direction:column;gap:8px}

.btn{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
}
.btn.secondary{
  background:#fff;
  color:var(--accent);
  border:1px solid #dbe9ff;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
  <div>
    <h1 id="pageTitle">Category</h1>
    <p class="muted">Select topic → then level</p>
  </div>
  <button onclick="history.back()" class="btn secondary">← Back</button>
</div>

<div class="hero">
  <div>
    <h2 id="heroTitle">Explore quizzes</h2>
    <div class="muted">Choose a topic and level</div>
  </div>
  <i class="bx bx-category" style="font-size:32px;color:var(--primary)"></i>
</div>

<div class="layout">

<!-- TOPICS -->
<div class="card">
  <h3 class="section-title">Topics</h3>
  <div id="topicsGrid" class="topics-grid"></div>
</div>

<!-- LEVELS + QUIZZES -->
<div class="card">
  <h3 class="section-title">Levels</h3>
  <div id="levelsBlock"></div>

  <div id="quizzesResultSection" style="margin-top:16px;display:none">
    <h4>Matched Quizzes</h4>
    <div id="quizzesList"></div>
    <div id="noQuizzesNote" class="muted" style="display:none">
      No quizzes found.
    </div>
  </div>
</div>

</div>
</div>

<script>
const CATEGORY = new URLSearchParams(location.search).get("category") || "Technical";

const TOPICS = {
  Technical:[
    {name:"Python",img:"https://images.unsplash.com/photo-1515879218367-8466d910aaa4"},
    {name:"Java",img:"https://i.ibb.co/HTgvw4dS/download-1.jpg"},
    {name:"C++",img:"https://images.unsplash.com/photo-1555066931-4365d14bab8c"},
    {name:"DBMS",img:"https://i.ibb.co/HTYhLtXc/download-2.jpg"},
    {name:"Computer Networks",img:"https://i.ibb.co/ynMph0P8/Exploring-Cable-Free-Computer-Networks-Types-and-Uses.jpg"}
  ]
};

const LEVELS=["Basic","Medium","Hard"];
let ALL_QUIZZES=[];
let selectedTopic=null;
let selectedLevel=null;

async function loadQuizzes(){
  const res=await apiFetch("/quizzes?category="+encodeURIComponent(CATEGORY));
  ALL_QUIZZES = res?.quizzes || res?.data || [];
}

function renderTopics(){
  const grid=document.getElementById("topicsGrid");
  grid.innerHTML="";
  TOPICS[CATEGORY].forEach(t=>{
    const d=document.createElement("div");
    d.className="topic-card";
    d.innerHTML=`
      <div class="topic-media"><img src="${t.img}"></div>
      <div class="topic-title">${t.name}</div>
      <div class="topic-desc">Click to select</div>`;
    d.onclick=()=>{
      document.querySelectorAll(".topic-card").forEach(x=>x.classList.remove("selected"));
      d.classList.add("selected");
      selectedTopic=t.name;
      selectedLevel=null;
      enableLevels();
      clearLevelSelection();
      filterQuizzes();
    };
    grid.appendChild(d);
  });
}

function renderLevels(){
  const lb=document.getElementById("levelsBlock");
  lb.innerHTML="";
  LEVELS.forEach(l=>{
    const d=document.createElement("div");
    d.className="level-card";
    d.textContent=l;
    d.onclick=()=>{
      if(!d.classList.contains("enabled")) return;
      document.querySelectorAll(".level-card").forEach(x=>x.classList.remove("selected"));
      d.classList.add("selected");
      selectedLevel=l;
      filterQuizzes();
    };
    lb.appendChild(d);
  });
}

function enableLevels(){
  document.querySelectorAll(".level-card").forEach(l=>{
    l.classList.add("enabled");
  });
}

function clearLevelSelection(){
  document.querySelectorAll(".level-card").forEach(l=>{
    l.classList.remove("selected");
  });
}

function filterQuizzes(){
  const list=document.getElementById("quizzesList");
  const wrap=document.getElementById("quizzesResultSection");
  const note=document.getElementById("noQuizzesNote");
  list.innerHTML="";
  wrap.style.display="block";

  const matched=ALL_QUIZZES.filter(q=>{
    return (!selectedTopic || q.field===selectedTopic || q.topic===selectedTopic)
        && (!selectedLevel || q.level===selectedLevel || q.difficulty===selectedLevel);
  });

  if(!matched.length){note.style.display="block";return;}
  note.style.display="none";

  matched.forEach(q=>{
    const d=document.createElement("div");
    d.className="quiz-card";
    d.innerHTML=`
      <div class="quiz-thumb">${q.coverImage?`<img src="${q.coverImage}">`:""}</div>
      <div><strong>${q.title}</strong><div class="muted">${q.level}</div></div>
      <div class="quiz-actions">
        <button class="btn secondary" onclick="location.href='quiz-details.html?quizId=${q._id}'">View</button>
        <button class="btn" onclick="location.href='quiz-play.html?quizId=${q._id}'">Start</button>
      </div>`;
    list.appendChild(d);
  });
}

(async()=>{
  document.getElementById("pageTitle").textContent=CATEGORY;
  document.getElementById("heroTitle").textContent="Explore "+CATEGORY+" quizzes";
  await loadQuizzes();
  renderTopics();
  renderLevels();
})();
</script>

</body>
</html>
